---
title: "IMPROVE cell line results"
author: "Sara gosline"
date: "2025-03-27"
output: html_document
---

This document focuses on results we can glean from the cell line specific analysis using the IMPROVE framework and coderdata
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo  =  TRUE)
library(tidyverse)
library(ggplot2)
source('coderdataResultsFunctions.R')

```

## Collect cross-model performance data and try out plotting
Currently the cross-model data results have been uploaded to synapse. Please request access on the [synapse team site](https://www.synapse.org/Team:3545388). 

```{r data, message=FALSE, echo=FALSE, warning=FALSE} 
  cdres <- getModelPerformanceData()

  metrics <- c('pcc','scc')
  res <- lapply(metrics,function(x) {
    res <- doFullPlot(x,cdres)
    cowplot::plot_grid(res$src,res$trg)
    ggsave(paste0('all_',metric,'_ridglines.pdf'),height = 12,width = 10)
    return(res$src)
})

print(res)

```

## Figure 3A: performance on cell lines

First result: evaluation on cell lines.

```{r model performance, message = FALSE, warning = FALSE}
#current list of ex vivo datasets. include liverpdo when complete


ccdres <- subset(cdres,!trg %in% exvivo)

ccres = lapply(metrics,function(x) {
  res <- doFullPlot(x, ccdres)
  cowplot::plot_grid(res$src,res$trg)
  ggsave(paste0('celllines',metric,'_ridglines.pdf'),height = 8,width = 10)
  return(res$src)
})  

print(ccres)

```

## Figure 3B - training/test set size

## Compare dataset size to performance

We wonder if the dataset size affects the predictive power.

```{r dataset size}

#number of combos
combos = list(beataml = 3033,ccle = 10911,ctrpv2 = 303520,fimm = 2457 ,gcsi = 12320,
             gdscv1 = 105808,gdscv2 = 45323,mpnst = 250, nci60 = 2317205,prism = 633169)

numsamples = list()
numdrugs = list()
#todo: we can also evaluate number of samples or drugs

#e can get performance summaries
gres <- ccdres  |>
  subset(model!='uno')|>
  subset(met=='scc') |>
  group_by(met,src,trg,model) |>
  summarize(meanVal=mean(value)) |>
  left_join(data.frame(src = names(combos),sampleNum = unlist(combos))) |>
  arrange(meanVal)

mom <- gres|>group_by(src,sampleNum)|>summarize(mv=mean(meanVal))|>arrange(mv)

#gres <- subset(gres,met=='scc')
gres$src = factor(gres$src,levels=unique(mom$src))
gres |> 
  ggplot(aes(x=src,y=meanVal,fill=model))+geom_boxplot()#+geom_jitter()


```


# Dataset prediction parsing
Now we have to go into the individual predidictions to pull out trends

## Figure 3

What does this figure look like



